# å¼€åœºåŠ¨ç”»åˆ¶ä½œé€»è¾‘è§£æä¸ä¿®å¤æ–¹æ¡ˆ

## ğŸ“½ï¸ é¡¹ç›®å¼€åœºåŠ¨ç”»åˆ¶ä½œé€»è¾‘

### 1. **åŠ¨ç”»æ¶æ„**

è¿™ä¸ªé¡¹ç›®çš„å¼€åœºåŠ¨ç”»æ˜¯åŸºäº **Unity Timeline + UI Canvas** çš„æ··åˆæ–¹æ¡ˆï¼š

```
PersistentScene
â”œâ”€â”€ TimelineManager (GameObject)
â”‚   â”œâ”€â”€ TimelineManager.cs (è„šæœ¬)
â”‚   â””â”€â”€ PlayableDirector (ç»„ä»¶)
â”‚       â””â”€â”€ NewGame CutsceneTimeline.playable (Timelineèµ„æº)
â”‚
â””â”€â”€ Intro Canvas (UI Canvas)
    â””â”€â”€ Panel
        â”œâ”€â”€ Shot (UI Image)
        â”œâ”€â”€ Shot (1) (UI Image)
        â”œâ”€â”€ Shot (2) (UI Image)
        â”œâ”€â”€ Shot (3) (UI Image)
        â”œâ”€â”€ Shot (4) (UI Image)
        â”œâ”€â”€ Shot (5) (UI Image)
        â””â”€â”€ Shot (7) (UI Image)
```

### 2. **åŠ¨ç”»æ§åˆ¶æœºåˆ¶**

#### **Timelineæ§åˆ¶UIå…ƒç´ **
- **PlayableDirector** æ’­æ”¾ `NewGame CutsceneTimeline.playable`
- **Timeline** æ§åˆ¶ Intro Canvas ä¸‹å„ä¸ª Shot çš„ï¼š
  - `m_Color.a` (é€æ˜åº¦)ï¼šå®ç°æ·¡å…¥æ·¡å‡ºæ•ˆæœ
  - `m_AnchoredPosition` (ä½ç½®)ï¼šå®ç°ç§»åŠ¨æ•ˆæœ
  - `m_IsActive` (æ¿€æ´»çŠ¶æ€)ï¼šæ§åˆ¶æ˜¾ç¤º/éšè—

#### **åŠ¨ç”»æ—¶é—´è½´**
ä»Timelineæ–‡ä»¶åˆ†æï¼ŒåŠ¨ç”»æ€»æ—¶é•¿çº¦ **21.5ç§’**ï¼š
- 0-2.45ç§’ï¼šShot æ·¡å…¥
- 3.4-5.0ç§’ï¼šShot(1) æ·¡å…¥
- 5.0-9.2ç§’ï¼šShot(2) æ·¡å…¥
- 9.2-10.9ç§’ï¼šShot(3) æ·¡å…¥
- 10.9-13.5ç§’ï¼šShot(4) æ·¡å…¥
- ç»§ç»­ç›´åˆ°21.5ç§’ç»“æŸ

### 3. **è„šæœ¬æ§åˆ¶æµç¨‹**

```mermaid
graph TD
    A[æ¸¸æˆå¯åŠ¨] --> B{æ˜¯å¦æ–°æ¸¸æˆ?}
    B -->|æ˜¯| C[hasSeenIntro = false]
    B -->|å¦-åŠ è½½å­˜æ¡£| D[hasSeenIntro = true]
    
    C --> E[OnAfterSceneLoadedEvent]
    D --> E
    
    E --> F{ShouldPlayIntro?}
    F -->|æ˜¯| G[æ˜¾ç¤ºIntro Canvas<br/>æ’­æ”¾Timeline]
    F -->|å¦| H[éšè—Intro Canvas<br/>ç›´æ¥è¿›å…¥æ¸¸æˆ]
    
    G --> I[ç›‘å¬ç©ºæ ¼/ESCé”®]
    I --> J{æŒ‰é”®è·³è¿‡?}
    J -->|æ˜¯| K[SkipCutscene]
    J -->|å¦| L[æ’­æ”¾å®Œæˆ]
    
    K --> M[åœæ­¢Timeline<br/>éšè—Canvas<br/>è¿›å…¥æ¸¸æˆ]
    L --> M
```

## ğŸ› åŸé—®é¢˜åˆ†æ

### **é—®é¢˜1ï¼šæŒ‰ç©ºæ ¼æ— æ³•è·³è¿‡**
**åŸå› **ï¼š
- Timelineæ­£åœ¨æ’­æ”¾ä½†è·³è¿‡é€»è¾‘ä¸æ­£ç¡®
- Intro Canvasæ²¡æœ‰è¢«æ­£ç¡®éšè—
- è¾“å…¥æ£€æµ‹å¯èƒ½è¢«å…¶ä»–UIé˜»æŒ¡

### **é—®é¢˜2ï¼šæ—§å­˜æ¡£ä»æ’­æ”¾åŠ¨ç”»**
**åŸå› **ï¼š
- `isLoadingExistingSave` æ ‡å¿—æœªæ­£ç¡®è®¾ç½®
- `hasSeenIntro` çŠ¶æ€ä¿å­˜/æ¢å¤æœºåˆ¶æœ‰é—®é¢˜
- Intro Canvasåœ¨åŠ è½½æ—¶é»˜è®¤æ¿€æ´»

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. **å¢å¼ºCanvasæ§åˆ¶**

```csharp
[Header("UIå¼•ç”¨")]
public Canvas introCanvas; // ç›´æ¥å¼•ç”¨Intro Canvas

/// <summary>
/// æ˜¾ç¤ºæˆ–éšè—Intro Canvas
/// </summary>
private void ShowIntroCanvas(bool show)
{
    if (introCanvas != null)
    {
        introCanvas.gameObject.SetActive(show);
        Debug.Log($"Intro Canvas {(show ? "æ˜¾ç¤º" : "éšè—")}");
    }
}
```

### 2. **æ”¹è¿›è·³è¿‡é€»è¾‘**

```csharp
public void SkipCutscene()
{
    if (currentDirector != null && currentDirector.state == PlayState.Playing)
    {
        Debug.Log("æ‰§è¡Œè·³è¿‡å¼€åœºåŠ¨ç”»");
        
        // åœæ­¢Timelineæ’­æ”¾
        currentDirector.Stop();
        
        // éšè—Intro Canvas
        ShowIntroCanvas(false);
        
        // æ ‡è®°å·²è§‚çœ‹å¹¶è¿›å…¥æ¸¸æˆ
        if (currentDirector == startDirector)
        {
            hasSeenIntro = true;
            EventHandler.CallUpdateGameStateEvent(GameState.Gameplay);
        }
    }
}
```

### 3. **å®Œå–„çŠ¶æ€åˆ¤æ–­**

```csharp
private bool ShouldPlayIntro()
{
    // ä¼˜å…ˆæ£€æŸ¥æ˜¯å¦æ­£åœ¨åŠ è½½å­˜æ¡£
    if (SaveLoadManager.Instance != null && SaveLoadManager.Instance.isLoadingExistingSave)
    {
        return false;
    }
    
    // æ£€æŸ¥æ˜¯å¦å·²ç»çœ‹è¿‡
    if (hasSeenIntro)
    {
        return false;
    }
    
    // å…¶ä»–æ¡ä»¶æ£€æŸ¥
    return currentDirector == startDirector && !hasSeenIntro;
}
```

## ğŸ® Unityç¼–è¾‘å™¨è®¾ç½®

### 1. **TimelineManagerè®¾ç½®**
1. åœ¨Unityç¼–è¾‘å™¨ä¸­é€‰æ‹© TimelineManager å¯¹è±¡
2. åœ¨Inspectorä¸­æ‰¾åˆ° TimelineManager ç»„ä»¶
3. å°† Intro Canvas æ‹–æ‹½åˆ° "Intro Canvas" å­—æ®µ
4. ç¡®ä¿ Start Director æŒ‡å‘æ­£ç¡®çš„ PlayableDirector

### 2. **Intro Canvasè®¾ç½®**
1. ç¡®ä¿ Intro Canvas çš„ Sort Order è¶³å¤Ÿé«˜ï¼ˆå¦‚10ï¼‰
2. ç¡®ä¿æ‰€æœ‰ Shot å¯¹è±¡éƒ½æ­£ç¡®é…ç½®äº† Image ç»„ä»¶
3. æ£€æŸ¥ Timeline ç»‘å®šæ˜¯å¦æ­£ç¡®

## ğŸ”§ è°ƒè¯•æ­¥éª¤

### 1. **æ–°æ¸¸æˆæµ‹è¯•**
```
1. å¯åŠ¨æ¸¸æˆï¼Œç‚¹å‡»ç©ºå­˜æ¡£æ§½
2. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æ˜¾ç¤ºï¼š"æ’­æ”¾å¼€åœºåŠ¨ç”»"
3. æµ‹è¯•ç©ºæ ¼é”®å’ŒESCé”®è·³è¿‡åŠŸèƒ½
4. ç¡®è®¤è·³è¿‡åæ˜¾ç¤ºï¼š"TimelineManager: æ ‡è®°ç©å®¶å·²ç»çœ‹è¿‡å¼€åœºåŠ¨ç”»"
```

### 2. **æ—§å­˜æ¡£æµ‹è¯•**
```
1. ä¿å­˜æ¸¸æˆè¿›åº¦ï¼ˆæŒ‰Ié”®ï¼‰
2. é‡å¯æ¸¸æˆï¼Œç‚¹å‡»æœ‰æ•°æ®çš„å­˜æ¡£æ§½
3. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æ˜¾ç¤ºï¼š"æ£€æµ‹åˆ°æ­£åœ¨åŠ è½½å­˜æ¡£ï¼Œè·³è¿‡å¼€åœºåŠ¨ç”»"
4. ç¡®è®¤ç›´æ¥è¿›å…¥æ¸¸æˆï¼Œæ— å¼€åœºåŠ¨ç”»
```

### 3. **æ§åˆ¶å°æ—¥å¿—ç›‘æ§**
```
é¢„æœŸæ—¥å¿—åºåˆ—ï¼š
- æ–°æ¸¸æˆï¼šæ’­æ”¾å¼€åœºåŠ¨ç”» â†’ æ£€æµ‹åˆ°è·³è¿‡æŒ‰é”® â†’ æ‰§è¡Œè·³è¿‡å¼€åœºåŠ¨ç”» â†’ Intro Canvas éšè—
- æ—§å­˜æ¡£ï¼šæ£€æµ‹åˆ°æ­£åœ¨åŠ è½½å­˜æ¡£ â†’ è·³è¿‡å¼€åœºåŠ¨ç”»ï¼Œç›´æ¥è¿›å…¥æ¸¸æˆ â†’ Intro Canvas éšè—
```

## ğŸ¯ å…³é”®ä¿®å¤ç‚¹

1. **è‡ªåŠ¨Canvaså¼•ç”¨**ï¼šä»£ç ä¼šè‡ªåŠ¨æŸ¥æ‰¾"Intro Canvas"å¯¹è±¡
2. **å¼ºåˆ¶Canvasæ§åˆ¶**ï¼šç¡®ä¿Canvasåœ¨åˆé€‚æ—¶æœºæ˜¾ç¤º/éšè—
3. **å¢å¼ºè·³è¿‡é€»è¾‘**ï¼šç›´æ¥åœæ­¢Timelineå¹¶éšè—Canvas
4. **å®Œå–„çŠ¶æ€æ£€æŸ¥**ï¼šå¤šé‡æ¡ä»¶ç¡®ä¿æ—§å­˜æ¡£è·³è¿‡åŠ¨ç”»
5. **è¯¦ç»†æ—¥å¿—è¾“å‡º**ï¼šä¾¿äºè°ƒè¯•å’ŒéªŒè¯

## ğŸ“ ä¿å­˜å­˜æ¡£çš„æ–¹æ³•

### æ‰‹åŠ¨ä¿å­˜ï¼š
- **æŒ‰ I é”®**ï¼šæ‰‹åŠ¨ä¿å­˜å½“å‰æ¸¸æˆè¿›åº¦
- **æŒ‰ O é”®**ï¼šåŠ è½½ä¿å­˜çš„æ¸¸æˆè¿›åº¦

### è‡ªåŠ¨ä¿å­˜ï¼š
- æ¸¸æˆç»“æŸæ—¶è‡ªåŠ¨è§¦å‘ä¿å­˜

### å­˜æ¡£ä½ç½®ï¼š
```
Windows: %AppData%/LocalLow/[å…¬å¸å]/[æ¸¸æˆå]/SAVE DATA/
æ–‡ä»¶æ ¼å¼: data0.json, data1.json, data2.json
```

ç°åœ¨æ‚¨çš„å¼€åœºåŠ¨ç”»ç³»ç»Ÿåº”è¯¥èƒ½æ­£ç¡®å·¥ä½œï¼šæ–°æ¸¸æˆæ’­æ”¾åŠ¨ç”»ï¼ˆå¯è·³è¿‡ï¼‰ï¼Œæ—§å­˜æ¡£ç›´æ¥è¿›å…¥æ¸¸æˆï¼ 